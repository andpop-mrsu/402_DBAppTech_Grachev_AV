# Проект "Сапер" с REST API Backend (Minesweeper SPA)

Полнофункциональное одностраничное веб-приложение классической игры "Сапёр" (Minesweeper) с серверным бэкендом на PHP и базой данных SQLite. Игрок открывает ячейки на прямоугольном поле, избегая мин. Цель игры — открыть все безопасные клетки. Если игрок открывает ячейку с миной, игра заканчивается поражением.

В отличие от клиентской версии, данная реализация использует серверное хранилище для сохранения всех игр и ходов, что обеспечивает:

- **Постоянное хранение данных** — все игры сохраняются на сервере в базе данных SQLite
- **Доступ из любого браузера** — история игр доступна с любого устройства
- **Централизованное управление** — единая база данных для всех пользователей
- **REST API архитектура** — чистое разделение фронтенда и бэкенда

## Основные возможности

- **Настраиваемое игровое поле** — выбор размера поля (2-30) и количества мин
- **Два режима управления** — обычный режим открытия ячеек и режим установки флагов
- **Счетчик мин** — показывает количество оставшихся неотмеченных мин
- **Серверное хранение** — все партии автоматически сохраняются в базу данных на сервере
- **Воспроизведение партий** — возможность просмотра сохраненных игр пошагово
- **Адаптивный дизайн** — автоматическая подстройка размера ячеек под размер экрана

## Правила и управление

### Правила игры

- Игрок открывает ячейки, избегая мин
- Если мины нет, ячейка отображает количество соседних заминированных ячеек (от 1 до 8)
- Если рядом с открытой ячейкой нет мин (0), автоматически открывается область незаминированных ячеек до тех пор, пока не встретится ячейка с цифрой
- Игрок может устанавливать флаги на подозрительные ячейки
- Первый ход всегда безопасен — мины размещаются после первого клика
- Победа достигается при открытии всех безопасных ячеек

### Управление

- **Левый клик** — открыть ячейку
- **Правый клик** — установить/убрать флаг
- **Кнопка "Новая игра"** — начать новую партию с настраиваемыми параметрами
- **Кнопка "Список игр"** — просмотреть историю всех сохраненных партий на сервере
- **Кнопка "Повтор игры"** — воспроизвести сохраненную партию пошагово
- **Кнопка "Справка"** — открыть справку по игре

### Цветовая индикация

- **Цифры 1-8** — количество мин в соседних ячейках (каждая цифра имеет свой цвет)
- **Оранжевая ячейка** — взорвавшаяся мина (при проигрыше)
- **Красные ячейки** — все остальные мины (показываются после проигрыше)

## Работа с сервером и базой данных

Игра автоматически сохраняет все партии на сервере через REST API в базу данных SQLite. Для каждой игры сохраняется:

### Информация об игре

- Дата и время игры
- Имя игрока (опционально)
- Размер игрового поля
- Количество мин
- Позиции всех мин (для точного воспроизведения)
- Результат игры (Победа/Поражение)
- Общее количество ходов

### Запись ходов

Каждый ход игрока записывается на сервер с информацией:

- Номер хода
- Тип действия (open — открытие ячейки, flag — установка/снятие флага)
- Координаты ячейки (row, col)
- Результат действия (safe, mine, win, flag_set, flag_removed)

### История игр

Модальное окно "Список игр" предоставляет:

- Таблицу всех сохраненных партий с полной информацией
- Отображение ID, игрока, даты, размера поля, количества мин, результата и числа ходов
- Возможность использовать ID игры для воспроизведения

### Воспроизведение партий

При выборе режима "Повтор игры" игра:

- Загружает данные игры с сервера через API
- Восстанавливает точное расположение мин используя сохраненные позиции
- Воспроизводит игровое поле с исходными параметрами
- Предоставляет пошаговое воспроизведение всех ходов
- Показывает результат каждого хода в реальном времени
- Отображает финальный результат партии (Победа/Поражение)
- Позволяет сбросить воспроизведение и начать заново

### Генератор случайных чисел

Используется стандартный генератор `Math.random()`:

- Размещение мин происходит случайным образом на клиенте
- Первый ход всегда безопасен — мины размещаются после первого клика
- Позиции мин отправляются на сервер и сохраняются для точного воспроизведения партий

### Хранилище данных

- **SQLite** — легковесная серверная база данных
- Две таблицы: `games` (результаты игр) и `moves` (ходы)
- Данные сохраняются на сервере и доступны из любого браузера
- Поддержка транзакций и подготовленных выражений (prepared statements)
- Автоматическое создание схемы при первом запуске

### Адаптивность

- Автоматический расчет размера ячеек в зависимости от размера экрана
- Минимальный размер ячейки: 25px
- Стандартный размер ячейки: 35px
- Поддержка полей от 2×2 до 30×30

## Требования

### Серверные требования

- **PHP 7.4** или выше
- **PDO SQLite** расширение (обычно включено по умолчанию)
- Права на запись в директорию `db/` для создания базы данных

### Клиентские требования

Современный браузер с поддержкой:

- ES6 модулей (import/export)
- Fetch API
- CSS Grid
- Async/Await

### Рекомендуемые браузеры:

- Google Chrome 61+
- Mozilla Firefox 60+
- Microsoft Edge 16+
- Safari 10.1+

## Установка и запуск

1. Перейдите в директорию проекта:
   ```bash
   cd Task08
   ```

2. Запустите встроенный веб-сервер PHP:
   ```bash
   php -S localhost:3000 -t public
   ```

3. Откройте браузер и перейдите по адресу:
   ```
   http://localhost:3000
   ```

4. База данных будет создана автоматически при первом запросе к API.

## Примечания

- Игра использует ES6 модули, поэтому требуется запуск через веб-сервер (не работает при открытии файла напрямую через `file://`)
- Все данные сохраняются на сервере в базе данных SQLite
- База данных создается автоматически при первом запуске
- Для корректной работы требуются права на запись в директорию `db/`